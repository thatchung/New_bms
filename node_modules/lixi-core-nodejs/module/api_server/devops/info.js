/** /lixidevops/healthcheck - kiêm tra server còn sống hay chết */

let Path = require('path');
let Fs = require('fs');

module.exports = ({ request, response }) => {
    let dirname = Path.dirname(require.main.filename);

    let package_info;
    while (!package_info) {
        package_info = Path.join(dirname, 'package.json');

        if (!Fs.existsSync(package_info)) {
            package_info = undefined;

            if (Path.dirname(dirname) === dirname) break;
            dirname = Path.dirname(dirname);
        }
    }

    package_info = Fs.readFileSync(package_info, 'utf8');
    package_info = JSON.parse(package_info);

    if (!package_info) {
        response.status = 500;
        response.body = `cannot find project metadata`;
        return;
    }

    response.status = 200;
    response.type = 'application/json';
    response.body = { version: package_info.version || 'undefined' };
};
