/** tạo lỗi */

let { HttpError } = require('../../err/_index');

module.exports = server =>
    (server.makeError = function({
        exception,
        code,
        http_code,
        message,
        data,
        default_http_code,
        default_message
    } = {}) {
        // tìm thông tin lỗi được quy định sẵn
        code = exception && exception.code ? exception.code : code;
        let error = server.options.errors.find(x => x.code === code);
        if (!error) {
            code = 'exception';
            error = server.options.errors.find(x => x.code === code);
        }

        // xác định http code
        if (!http_code) {
            http_code =
                error && error.http_code ? error.http_code : default_http_code;
            if (exception && exception.http_code)
                http_code = exception.http_code;
        }

        // xác định message
        if (!message) {
            message = error && error.message ? error.message : default_message;
            if (exception && exception.message) message = exception.message;
        }

        // xác định data
        if (!data) {
            data = exception && exception.data ? exception.data : undefined;
        }

        return new HttpError({
            code,
            message,
            data,
            http_code
        });
    });
