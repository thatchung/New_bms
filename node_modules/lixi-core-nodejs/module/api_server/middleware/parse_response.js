let Joi = require('../../joi/_index');

module.exports = server =>
    server.registerMiddleware({
        key: 'parse_response',
        summary: 'thực hiện xử lý response',
        handler: async function({ context, server, request, response, api }) {
            try {
                if (api.response) {
                    context.result = Joi.validateValue(
                        { response: context.result },
                        api.response,
                        { stripUnknown: true }
                    );
                } else {
                    context.result = undefined;
                }
            } catch (e) {
                throw server.makeError({
                    code: 'bad_response',
                    default_http_code: 500,
                    default_message: 'bad response',
                    exception: e
                });
            }
        }
    });
