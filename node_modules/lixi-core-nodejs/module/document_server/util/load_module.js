let CalculateCodeSize = require('./calculate_code_size');
let ListAllFile = require('../../helper/list_all_file');
let ListRequire = require('../util/list_require');

module.exports = function({ aliases, document }) {
    for (let modu of document.info.modules) {
        let modu_files = ListAllFile({ dir: modu.dir, extnames: ['.js'] });

        // #region [code size]

        if (!modu.code_size) modu.code_size = 0;

        for (file of modu_files) {
            modu.code_size += CalculateCodeSize({ file });
        }

        // #endregion

        // #region [module dependencies]

        if (!modu.module_dependencies) modu.module_dependencies = [];

        for (file of modu_files) {
            let list_require = ListRequire({
                aliases,
                document,
                file,
                remove_external_endpont: true
            });

            for (let require of list_require) {
                if (require.module === modu.name) continue;

                modu.module_dependencies.push({
                    from: file,
                    to: require.file,
                    module: require.module
                });
            }
        }

        // #endregion
    }
};
