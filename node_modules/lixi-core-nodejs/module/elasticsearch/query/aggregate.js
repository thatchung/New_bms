/** thực hiện truy vấn search */

module.exports = ({ elastic, query }) =>
    (query.aggregate = async function() {
        let data = await elastic.client.search({
            index: query._body.index,
            body: {
                query: {
                    bool: {
                        must: query._body.filter_must || [],
                        should: query._body.filter_should || [],
                        must_not: query._body.filter_must_not || []
                    }
                },
                aggregations: query._body.aggregations
            }
        });

        return data.body.aggregations;
    });
