/** kiểm tra kết quả đầu ra của api */

let TYPE_ALLOW = [
    'boolean',
    'number',
    'string',
    'timestamp',
    'array',
    'object',
    'any'
];

function validate({ path, response }) {
    if (!/^[a-z0-9_.]+$/g.test(path)) {
        // eslint-disable-next-line max-len
        throw Error(
            `child "${path}" fails because [name of "${path}" is invalid "^[a-z0-9_.]+$" pattern]`
        );
    }

    if (!TYPE_ALLOW.includes(response.type)) {
        // eslint-disable-next-line max-len
        throw Error(
            `child "${path}" fails because [type of "${path}" must be one of ${TYPE_ALLOW.join(
                ', '
            )}]`
        );
    }

    switch (response.type) {
        case 'array':
            if (!response.items || response.items.length !== 1) {
                throw Error(
                    `child "${path}" fails because ["${path}" must have 1 item type]`
                );
            }

            validate({
                path,
                response: response.items[0]
            });
            break;

        case 'object':
            if (response.flags && response.flags.func === true) break;

            if (
                !response.children ||
                Object.keys(response.children).length <= 0
            ) {
                throw Error(
                    `child "${path}" fails because ["${path}" have at least 1 property]`
                );
            }

            for (let key in response.children) {
                if (!response.children.hasOwnProperty(key)) continue;

                validate({
                    path: path + '.' + key,
                    response: response.children[key]
                });
            }
            break;
    }
}

module.exports = validate;
