/** gọi điểm giao tiếp */

let HandlerFile = require('../util/handler_file');
let HandlerDirect = require('../util/handler_direct');
let HandlerRest = require('../util/handler_rest');
let HandlerRestRsa = require('../util/handler_rest_rsa');

module.exports = hub =>
    (hub.getEndpoint = function(key) {
        let endpoint = hub.endpoints.find(x => x.key === key);
        if (!endpoint) throw Error(`hub endpoint "${key}" is not existed`);

        if (endpoint.protocol === 'file') return HandlerFile(endpoint);

        if (endpoint.protocol === 'direct') return HandlerDirect.bind(endpoint);

        if (endpoint.protocol === 'rest') return HandlerRest.bind(endpoint);

        if (endpoint.protocol === 'rest_rsa') return HandlerRestRsa.bind(endpoint);

        throw Error(
            `protocol "${endpoint.protocol}" of endpoint "${endpoint.key}" is not supported`
        );
    });
