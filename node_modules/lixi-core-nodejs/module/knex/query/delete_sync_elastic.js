/** xóa dữ liệu và đồng bộ với elastic */
/* eslint-disable max-len */

module.exports = ({ knex, query }) =>
    (query.deleteSyncElastic = async function(id, options, elasticsearch) {
        if (knex.isTransaction)
            throw new Error(`cannot sync with elastic in transaction`);

        if (!elasticsearch) elasticsearch = knex.options.elasticsearch;
        if (!elasticsearch)
            throw new Error(
                `cannot sync with elasticsearch when elasticsearch client is undefined`
            );

        await this.where({ id: id }).delete();

        await elasticsearch
            .query()
            .index(this._single.table)
            .id(id)
            .delete(options);
    });
