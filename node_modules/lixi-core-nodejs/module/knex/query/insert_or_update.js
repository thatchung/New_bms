/** tạo dữ liệu và đồng bộ với elastic */

module.exports = ({ knex, query }) =>
    (query.insertOrUpdate = async function({ insert, update }) {
        let result = await this.client.raw(
            this.clone()
                .insert(insert)
                .toString() +
                ' on duplicate key update ' +
                this.clone()
                    .update(update)
                    .toString()
                    .substr(14 + this._single.table.length)
        );

        result = result[0];
        result.isUpdate = result.affectedRows > 1;

        return result;
    });
