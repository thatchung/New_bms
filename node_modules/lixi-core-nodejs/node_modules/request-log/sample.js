const Express = require('express');
const Moment = require('moment');

(async () => {
    const Custom = require('./index').Custom;
    const customLog = new Custom();

    // connection, serviceName, requestKey, filter, customResponse
    await customLog.setup({
        enable: true,
        canLog: true,
        serviceName: 'custom_log',
        connection: {
            host: 'https://elk.lixiapp.com/',
            keepAlive: false,
        },
    });

    // customLog.update({
    //     id: 1,
    //     data: {
    //         response_time: Moment().valueOf(),
    //         process_time: 10,
    //         http_code: 200,
    //     },
    // });
    const express = require('express')
    const app = express()

    app.get('/', async (req, res) => {
        const id = Moment().valueOf();
        const data = await customLog.writeReq({
            id,
            client_name: 'custom_log',
            req,
        });

        res.send('Hello World!');

        await customLog.update({
            id,
            data: {
                response_time: Moment().valueOf(),
                process_time: 10,
                http_code: 200,
            },
        });
        console.log(id);
    });

    app.listen(3000, () => console.log(`Example app listening on port 300!`));
})()