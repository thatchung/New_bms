const Express = require('express');
const RequestLog = require('./index');
const app = Express();
const port = 3000;

// RequestLog.RequestOut.setup({
//     enable: true,
//     service_name: 'demo',
//     connection: {
//         host: 'https://elk.lixiapp.com/',
//         keepAlive: false,
//     },
// });

// setup connection
RequestLog.RequestIn.setup({
    enable: true,
    service_name: 'demo',
    connection: {
        host: 'https://elk.lixiapp.com/',
        keepAlive: false,
    },
    customResponse: (data) => {
        console.log(data);
        delete data.res;
        delete data.req;
        return data;
    },
});

// setup middleware before any route
app.use(RequestLog.RequestIn.before);

app.get('/', (req, res, next) => {
    res.send('Hello World!');
    next();
});

// setup middleware after any route
app.use(RequestLog.RequestIn.after);

app.listen(port, () => {
    console.log(`Example app listening on port ${port}!`)
});
