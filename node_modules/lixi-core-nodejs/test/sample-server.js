let { ApiServer, DocumentServer, Joi } = require('../index');

(async () => {
    let { api_server, document_server } = setupServer();

    await api_server.start();
    await document_server.start();

    console.log(`api server is started at ${api_server.options.port}`);
    console.log(
        `document server is started at ${document_server.options.port}`
    );
})();

function setupServer() {
    // #region [setup api server]

    let api_server = ApiServer.init();

    api_server.registerEndpoint({
        method: 'GET',
        path: '/test',
        parameter: {
            data: Joi.string()
        },
        response: Joi.any(),
        handler: async function({ args }) {
            return args;
        }
    });

    // #endregion

    // #region [setup document server]

    let document_server = DocumentServer.init({
        bitbucket_slug: 'lixidev/lixibook-news-feed',
        bitbucket_branch: 'master',
        auth: {
            mode: 'basic',
            list_basic_account: [{ username: 'admin', password: 'admin' }]
        }
    });

    document_server.loadApiServer(api_server);

    // #endregion

    return { api_server, document_server };
}
